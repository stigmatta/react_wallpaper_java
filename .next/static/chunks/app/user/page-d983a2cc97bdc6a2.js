(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[584],{4202:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(5155),a=s(2115),l=s(9576),i=s(5695),o=s(6766),c=s(6874),n=s.n(c);let d=()=>{let{user:e,isAuthenticated:t,logout:s}=(0,l.A)(),c=(0,i.useRouter)(),[d,m]=(0,a.useState)([]),[x,h]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{if(!t)return void c.push("/login");(async()=>{try{let e=localStorage.getItem("token"),t=await fetch("http://localhost:8080/orders/my-history",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();console.log("Raw Orders Data:",JSON.stringify(e,null,2));let s=await Promise.all(e.map(async e=>{let t=await Promise.all(e.items.map(async e=>{let t="Товар",s="";try{if(e.productId){let r="WALLPAPER"===e.productType?"http://localhost:8080/wallpapers/".concat(e.productId):"http://localhost:8080/souvenirs/".concat(e.productId),a=await fetch(r);if(a.ok){let e=await a.json();t=e.name,s=e.image}else console.warn("Failed to fetch product details for ".concat(e.productId,": ").concat(a.status))}}catch(e){console.error("Error fetching product details",e)}let r="number"==typeof e.price?e.price:Number(e.price),a="number"==typeof e.quantity?e.quantity:Number(e.quantity),l=isNaN(r)?0:r,i=isNaN(a)?1:a;return{...e,productName:t,imageUrl:s,price:l,quantity:i,totalPrice:l*i}})),s="number"==typeof e.price?e.price:Number(e.price);return{id:e.id,orderDate:e.orderDate||new Date().toISOString(),status:e.status||"PENDING",totalAmount:isNaN(s)?0:s,shippingAddress:e.shippingAddress||"Адреса не вказана",items:t}}));m(s)}else console.error("Failed to fetch orders")}catch(e){console.error("Error fetching orders:",e)}finally{h(!1)}})()},[t,c]),e)?(0,r.jsx)("div",{className:"flex flex-col px-4 sm:px-8 md:px-[clamp(2rem,6vw,8rem)] py-12 bg-gray-50 min-h-screen",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto w-full",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8 xl:gap-12",children:[(0,r.jsx)("div",{className:"w-full lg:w-1/3 xl:w-1/4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 sticky top-24",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,r.jsx)("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-3xl font-bold text-navy",children:e.username.charAt(0).toUpperCase()}),(0,r.jsx)("h2",{className:"text-xl font-bold text-navy",children:e.username}),(0,r.jsx)("p",{className:"text-gray-500",children:e.email})]}),(0,r.jsxs)("div",{className:"border-t border-gray-100 pt-6",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4",children:"Мій Профіль"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"ID користувача:"}),(0,r.jsx)("span",{className:"font-medium text-navy",children:e.id})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Email:"}),(0,r.jsx)("span",{className:"font-medium text-navy",children:e.email})]})]})]}),(0,r.jsx)("div",{className:"border-t border-gray-100 mt-6 pt-6",children:(0,r.jsx)("button",{onClick:s,className:"w-full bg-gray-50 text-navy font-bold rounded-xl py-3 hover:bg-gray-100 transition-colors border border-gray-200",children:"Вийти"})})]})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-navy mb-8",children:"Історія замовлень"}),x?(0,r.jsx)("div",{className:"flex justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal"})}):0===d.length?(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-12 text-center border border-gray-100 shadow-sm",children:[(0,r.jsx)("div",{className:"text-gray-400 text-xl mb-6",children:"У вас ще немає замовлень"}),(0,r.jsx)(n(),{href:"/wallpapers",className:"inline-block bg-teal text-white font-bold rounded-xl px-8 py-3 hover:bg-navy transition-colors",children:"Перейти до каталогу"})]}):(0,r.jsx)("div",{className:"space-y-6",children:d.map(e=>(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 transition-shadow hover:shadow-md",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b border-gray-50 pb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Замовлення №"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-navy",children:["#",e.id.slice(0,8)]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:items-end mt-2 sm:mt-0",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:new Date(e.orderDate).toLocaleDateString()}),(0,r.jsx)("span",{className:"inline-flex px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide\n                           ".concat("COMPLETED"===e.status?"bg-green-100 text-green-700":"PENDING"===e.status?"bg-yellow-100 text-yellow-700":"CANCELLED"===e.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:e.status})]})]}),(0,r.jsx)("div",{className:"space-y-4 mb-6",children:e.items.map((e,t)=>(0,r.jsxs)("div",{className:"flex gap-4 items-center",children:[e.imageUrl?(0,r.jsx)("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden flex-shrink-0 border border-gray-100",children:(0,r.jsx)(o.default,{src:e.imageUrl.startsWith("http")?e.imageUrl:"http://localhost:8080".concat(e.imageUrl),alt:e.productName,fill:!0,className:"object-cover"})}):(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400 flex-shrink-0",children:"Img"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-navy line-clamp-2",children:e.productName}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:[e.quantity," шт x ",e.price," грн"]})]}),(0,r.jsxs)("div",{className:"font-bold text-navy",children:[e.totalPrice," грн"]})]},t))}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gray-100",children:[(0,r.jsxs)("div",{className:"text-gray-500 text-sm",children:["Доставка:"," ",(0,r.jsx)("span",{className:"text-navy font-medium",children:e.shippingAddress})]}),(0,r.jsxs)("div",{className:"text-xl font-bold text-teal",children:[e.totalAmount," грн"]})]})]},e.id))})]})]})})}):null}},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},8361:(e,t,s)=>{Promise.resolve().then(s.bind(s,4202))},9576:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,AuthProvider:()=>o});var r=s(5155),a=s(2115),l=s(5695);let i=(0,a.createContext)(void 0),o=e=>{let{children:t}=e,[s,o]=(0,a.useState)(null),c=(0,l.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{o(JSON.parse(t))}catch(e){console.error("Failed to parse user data",e),localStorage.removeItem("token"),localStorage.removeItem("user")}},[]);let n=async()=>{let e=localStorage.getItem("token");if(e)try{await fetch("http://localhost:8080/users/logout",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}})}catch(e){console.error("Logout failed on server",e)}localStorage.removeItem("token"),localStorage.removeItem("user"),o(null),c.push("/login")};return(0,r.jsx)(i.Provider,{value:{user:s,login:(e,t)=>{localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t)),o(t)},logout:n,isAuthenticated:!!s},children:t})},c=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within a AuthProvider");return e}}},e=>{e.O(0,[874,766,441,964,358],()=>e(e.s=8361)),_N_E=e.O()}]);