(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{455:(e,t,r)=>{Promise.resolve().then(r.bind(r,9690))},5695:(e,t,r)=>{"use strict";var o=r(8999);r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}})},9576:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,AuthProvider:()=>n});var o=r(5155),a=r(2115),s=r(5695);let l=(0,a.createContext)(void 0),n=e=>{let{children:t}=e,[r,n]=(0,a.useState)(null),i=(0,s.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{n(JSON.parse(t))}catch(e){console.error("Failed to parse user data",e),localStorage.removeItem("token"),localStorage.removeItem("user")}},[]);let c=async()=>{let e=localStorage.getItem("token");if(e)try{await fetch("http://localhost:8080/users/logout",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}})}catch(e){console.error("Logout failed on server",e)}localStorage.removeItem("token"),localStorage.removeItem("user"),n(null),i.push("/login")};return(0,o.jsx)(l.Provider,{value:{user:r,login:(e,t)=>{localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t)),n(t)},logout:c,isAuthenticated:!!r},children:t})},i=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within a AuthProvider");return e}},9690:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var o=r(5155),a=r(2115),s=r(6874),l=r.n(s),n=r(5695),i=r(9576),c=r(1530);function u(){let[e,t]=(0,a.useState)(""),[r,s]=(0,a.useState)(""),u=(0,n.useRouter)(),{login:d}=(0,i.A)(),h=async t=>{t.preventDefault();try{let t=await fetch("http://localhost:8080/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usernameOrEmail:e,password:r})});if(!t.ok){let e,r=await t.text();try{let t=JSON.parse(r);e=t.message||t.error||JSON.stringify(t)}catch(t){console.error("Failed to parse error response:",t),e=r}throw Error(e||"Server error: ".concat(t.status))}let o=await t.text();console.log("Raw login response:",o);let a="";try{let e=JSON.parse(o);"string"==typeof e?a=e:"object"==typeof e&&null!==e&&(a=e.token||e.accessToken||e.jwt||"")}catch(e){console.error("Token parsing error:",e),a=o}if(!a)throw Error("Could not extract token from login response");let s=await fetch("http://localhost:8080/users/profile",{method:"GET",headers:{Authorization:"Bearer ".concat(a)}});if((401===s.status||403===s.status)&&(console.warn("Bearer auth failed, retrying with raw token..."),s=await fetch("http://localhost:8080/users/profile",{method:"GET",headers:{Authorization:a}})),!s.ok){let e=await s.text();throw console.error("Profile fetch failed:",s.status,e),Error("Failed to fetch profile")}let l=await s.json();d(a,{id:l.id,username:l.username,email:l.email}),c.Ay.success("Успішний вхід!"),u.push("/")}catch(t){console.error("Login error:",t);let e=t instanceof Error?t.message:"Невірний email або пароль";c.Ay.error(e)}};return(0,o.jsx)("div",{className:"flex flex-col items-center justify-center px-4 py-16 sm:px-8 min-h-screen bg-gray-50",children:(0,o.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl px-6 py-8 shadow-sm border border-gray-100",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-navy mb-8 text-center",children:"Вхід"}),(0,o.jsxs)("form",{onSubmit:h,className:"flex flex-col gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"email",className:"block text-navy font-medium mb-2",children:"Email або Ім'я користувача"}),(0,o.jsx)("input",{type:"text",id:"email",value:e,onChange:e=>t(e.target.value),className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal/20 focus:border-teal transition-all",placeholder:"example@mail.com або username",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"password",className:"block text-navy font-medium mb-2",children:"Пароль"}),(0,o.jsx)("input",{type:"password",id:"password",value:r,onChange:e=>s(e.target.value),className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal/20 focus:border-teal transition-all",placeholder:"********",required:!0})]}),(0,o.jsx)("button",{type:"submit",className:"w-full bg-teal text-white font-bold rounded-xl py-4 text-lg hover:bg-navy transition-all shadow-lg shadow-teal/20 hover:shadow-navy/20 mt-4",children:"УВІЙТИ"})]}),(0,o.jsxs)("div",{className:"mt-6 text-center text-navy",children:["Ще не маєте акаунту?"," ",(0,o.jsx)(l(),{href:"/register",className:"text-teal font-semibold hover:underline",children:"Зареєструватися"})]})]})})}}},e=>{e.O(0,[874,530,441,964,358],()=>e(e.s=455)),_N_E=e.O()}]);