{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/morri/WebstormProjects/react_wallpaper_java/src/app/user/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { Order, OrderDTO } from \"@/interfaces/order\";\r\n\r\nconst UserPage = () => {\r\n    const { user, isAuthenticated, logout } = useAuth();\r\n    const router = useRouter();\r\n    const [orders, setOrders] = useState<Order[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!isAuthenticated) {\r\n            router.push(\"/login\");\r\n            return;\r\n        }\r\n\r\n        const fetchOrders = async () => {\r\n            try {\r\n                const token = localStorage.getItem(\"token\");\r\n                const res = await fetch(\"http://localhost:8080/orders/my-history\", {\r\n                    headers: {\r\n                        Authorization: `Bearer ${token}`,\r\n                    },\r\n                });\r\n\r\n                if (res.ok) {\r\n                    const rawData: OrderDTO[] = await res.json();\r\n\r\n                    const formattedOrders = rawData.map((order) => {\r\n                        const items = order.items.map((item) => {\r\n                            // Convert types safely if they come as strings from API\r\n                            const price = Number(item.purchasePrice) || 0;\r\n                            const qty = Number(item.quantity) || 1;\r\n\r\n                            return {\r\n                                ...item,\r\n                                // Using 'name' directly from your OrderItemHistoryResponse record\r\n                                productName: item.name || \"Товар\",\r\n                                price: price,\r\n                                quantity: qty,\r\n                                totalPrice: price * qty,\r\n                            };\r\n                        });\r\n\r\n                        return {\r\n                            id: order.id,\r\n                            orderDate: order.createdAt || new Date().toISOString(),\r\n                            totalAmount: Number(order.totalPrice) || 0,\r\n                            items: items,\r\n                        };\r\n                    });\r\n\r\n                    // Sort newest first\r\n                    formattedOrders.sort(\r\n                        (a, b) => new Date(b.orderDate).getTime() - new Date(a.orderDate).getTime()\r\n                    );\r\n\r\n                    setOrders(formattedOrders);\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error fetching orders:\", error);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchOrders();\r\n    }, [isAuthenticated, router]);\r\n\r\n    if (!user) return null;\r\n\r\n    return (\r\n        <div className=\"flex flex-col px-4 sm:px-8 md:px-[clamp(2rem,6vw,8rem)] py-12 bg-gray-50 min-h-screen\">\r\n            <div className=\"max-w-7xl mx-auto w-full\">\r\n                <div className=\"flex flex-col lg:flex-row gap-8 xl:gap-12\">\r\n                    {/* Sidebar */}\r\n                    <div className=\"w-full lg:w-1/3 xl:w-1/4\">\r\n                        <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 sticky top-24\">\r\n                            <div className=\"flex flex-col items-center mb-6\">\r\n                                <div className=\"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-3xl font-bold text-navy\">\r\n                                    {user.username.charAt(0).toUpperCase()}\r\n                                </div>\r\n                                <h2 className=\"text-xl font-bold text-navy\">{user.username}</h2>\r\n                                <p className=\"text-gray-500\">{user.email}</p>\r\n                            </div>\r\n                            <div className=\"border-t border-gray-100 mt-6 pt-6\">\r\n                                <button\r\n                                    onClick={logout}\r\n                                    className=\"w-full bg-gray-50 text-navy font-bold rounded-xl py-3 hover:bg-gray-100 transition-colors border border-gray-200\"\r\n                                >\r\n                                    Вийти\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Order History */}\r\n                    <div className=\"flex-1\">\r\n                        <h1 className=\"text-3xl font-bold text-navy mb-8\">Історія замовлень</h1>\r\n\r\n                        {loading ? (\r\n                            <div className=\"flex justify-center py-12\">\r\n                                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-teal\"></div>\r\n                            </div>\r\n                        ) : orders.length === 0 ? (\r\n                            <div className=\"bg-white rounded-2xl p-12 text-center border border-gray-100 shadow-sm\">\r\n                                <div className=\"text-gray-400 text-xl mb-6\">У вас ще немає замовлень</div>\r\n                                <Link href=\"/printings\" className=\"inline-block bg-teal text-white font-bold rounded-xl px-8 py-3 hover:bg-navy\">\r\n                                    До каталогу\r\n                                </Link>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-6\">\r\n                                {orders.map((order) => (\r\n                                    <div key={order.id} className=\"bg-white rounded-2xl p-6 shadow-sm border border-gray-100\">\r\n                                        <div className=\"flex justify-between items-start mb-6 border-b border-gray-50 pb-4\">\r\n                                            <div>\r\n                                                <div className=\"text-sm text-gray-500 mb-1\">Замовлення №</div>\r\n                                                <div className=\"text-lg font-bold text-navy\">#{order.id.slice(0, 8)}</div>\r\n                                            </div>\r\n                                            <div className=\"text-sm text-gray-500\">\r\n                                                {new Date(order.orderDate).toLocaleString(\"uk-UA\")}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"space-y-4 mb-6\">\r\n                                            {order.items.map((item, idx) => (\r\n                                                <div key={idx} className=\"flex justify-between items-center\">\r\n                                                    <div>\r\n                                                        {/* Displaying the name from the Record */}\r\n                                                        <h4 className=\"font-bold text-navy\">{item.productName}</h4>\r\n                                                        <div className=\"text-sm text-gray-500\">\r\n                                                            {item.quantity} шт x {item.price} грн\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className=\"font-bold text-navy\">{item.totalPrice} грн</div>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n\r\n                                        <div className=\"flex justify-end pt-4 border-t border-gray-100\">\r\n                                            <div className=\"text-xl font-bold text-teal\">{order.totalAmount} грн</div>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default UserPage;"],"names":[],"mappings":"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","debugId":null}}]
}