{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/dimabalawov/wallpaper_imp/src/app/user/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { useRouter } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { Order, OrderDTO } from \"@/interfaces/order\";\n\nconst UserPage = () => {\n  const { user, isAuthenticated, logout } = useAuth();\n  const router = useRouter();\n  const [orders, setOrders] = useState<Order[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      router.push(\"/login\");\n      return;\n    }\n\n    const fetchOrders = async () => {\n      try {\n        const token = localStorage.getItem(\"token\");\n        const res = await fetch(\"http://localhost:8080/orders/my-history\", {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        });\n        if (res.ok) {\n          const rawData: OrderDTO[] = await res.json();\n          console.log(\"Raw Orders Data:\", JSON.stringify(rawData, null, 2));\n\n          // Enrich order items with product details\n          const enrichedOrders = await Promise.all(\n            rawData.map(async (order) => {\n              const enrichedItems = await Promise.all(\n                order.items.map(async (item) => {\n                  let productName = \"Товар\";\n                  let imageUrl = \"\";\n\n                  // Debug logging for item\n                  // console.log(\"Processing item:\", item);\n\n                  try {\n                    // Decide endpoint based on product type\n                    // Validating ID existence to separate \"missing ID\" from \"fetch failed\"\n                    if (item.productId) {\n                      const endpoint =\n                        item.productType === \"WALLPAPER\"\n                          ? `http://localhost:8080/wallpapers/${item.productId}`\n                          : `http://localhost:8080/souvenirs/${item.productId}`;\n\n                      const productRes = await fetch(endpoint);\n\n                      if (productRes.ok) {\n                        const productData = await productRes.json();\n                        productName = productData.name;\n                        imageUrl = productData.image;\n                      } else {\n                        console.warn(\n                          `Failed to fetch product details for ${item.productId}: ${productRes.status}`\n                        );\n                      }\n                    }\n                  } catch (e) {\n                    console.error(\"Error fetching product details\", e);\n                  }\n\n                  // Robust calculation\n                  const price =\n                    typeof item.purchasePrice === \"number\"\n                      ? item.purchasePrice\n                      : Number(item.purchasePrice);\n                  const qty =\n                    typeof item.quantity === \"number\"\n                      ? item.quantity\n                      : Number(item.quantity);\n                  const safePrice = isNaN(price) ? 0 : price;\n                  const safeQty = isNaN(qty) ? 1 : qty;\n\n                  return {\n                    ...item,\n                    productName,\n                    imageUrl,\n                    price: safePrice,\n                    quantity: safeQty,\n                    totalPrice: safePrice * safeQty,\n                  };\n                })\n              );\n\n              // Map root level fields safely\n              const orderTotal =\n                typeof order.totalPrice === \"number\"\n                  ? order.totalPrice\n                  : Number(order.totalPrice);\n\n              return {\n                id: order.id,\n                orderDate: order.createdAt || new Date().toISOString(),\n                // status: \"COMPLETED\", // Removed\n                totalAmount: isNaN(orderTotal) ? 0 : orderTotal,\n                // shippingAddress: \"Адреса не вказана\", // Removed\n                items: enrichedItems,\n              };\n            })\n          );\n\n          // Sort orders by creation date (newest first)\n          enrichedOrders.sort(\n            (a, b) =>\n              new Date(b.orderDate).getTime() - new Date(a.orderDate).getTime()\n          );\n\n          setOrders(enrichedOrders);\n        } else {\n          console.error(\"Failed to fetch orders\");\n        }\n      } catch (error) {\n        console.error(\"Error fetching orders:\", error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchOrders();\n  }, [isAuthenticated, router]);\n\n  if (!user) {\n    return null; // Or a loading spinner\n  }\n\n  return (\n    <div className=\"flex flex-col px-4 sm:px-8 md:px-[clamp(2rem,6vw,8rem)] py-12 bg-gray-50 min-h-screen\">\n      <div className=\"max-w-7xl mx-auto w-full\">\n        <div className=\"flex flex-col lg:flex-row gap-8 xl:gap-12\">\n          {/* Sidebar / User Info */}\n          <div className=\"w-full lg:w-1/3 xl:w-1/4\">\n            <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 sticky top-24\">\n              <div className=\"flex flex-col items-center mb-6\">\n                <div className=\"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-3xl font-bold text-navy\">\n                  {user.username.charAt(0).toUpperCase()}\n                </div>\n                <h2 className=\"text-xl font-bold text-navy\">{user.username}</h2>\n                <p className=\"text-gray-500\">{user.email}</p>\n              </div>\n\n              <div className=\"border-t border-gray-100 pt-6\">\n                <h3 className=\"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4\">\n                  Мій Профіль\n                </h3>\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center text-sm\">\n                    <span className=\"text-gray-500\">ID користувача:</span>\n                    <span className=\"font-medium text-navy\">{user.id}</span>\n                  </div>\n                  <div className=\"flex justify-between items-center text-sm\">\n                    <span className=\"text-gray-500\">Email:</span>\n                    <span className=\"font-medium text-navy\">{user.email}</span>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"border-t border-gray-100 mt-6 pt-6\">\n                <button\n                  onClick={logout}\n                  className=\"w-full bg-gray-50 text-navy font-bold rounded-xl py-3 hover:bg-gray-100 transition-colors border border-gray-200\"\n                >\n                  Вийти\n                </button>\n              </div>\n            </div>\n          </div>\n\n          {/* Main Content / Order History */}\n          <div className=\"flex-1\">\n            <h1 className=\"text-3xl font-bold text-navy mb-8\">\n              Історія замовлень\n            </h1>\n\n            {loading ? (\n              <div className=\"flex justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-teal\"></div>\n              </div>\n            ) : orders.length === 0 ? (\n              <div className=\"bg-white rounded-2xl p-12 text-center border border-gray-100 shadow-sm\">\n                <div className=\"text-gray-400 text-xl mb-6\">\n                  У вас ще немає замовлень\n                </div>\n                <Link\n                  href=\"/wallpapers\"\n                  className=\"inline-block bg-teal text-white font-bold rounded-xl px-8 py-3 hover:bg-navy transition-colors\"\n                >\n                  Перейти до каталогу\n                </Link>\n              </div>\n            ) : (\n              <div className=\"space-y-6\">\n                {orders.map((order) => (\n                  <div\n                    key={order.id}\n                    className=\"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 transition-shadow hover:shadow-md\"\n                  >\n                    <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b border-gray-50 pb-4\">\n                      <div>\n                        <div className=\"text-sm text-gray-500 mb-1\">\n                          Замовлення №\n                        </div>\n                        <div className=\"text-lg font-bold text-navy\">\n                          #{order.id.slice(0, 8)}\n                        </div>\n                      </div>\n                      <div className=\"flex flex-col sm:items-end mt-2 sm:mt-0\">\n                        <div className=\"text-sm text-gray-500 mb-1\">\n                          {new Date(order.orderDate).toLocaleString(\"uk-UA\", {\n                            year: \"numeric\",\n                            month: \"numeric\",\n                            day: \"numeric\",\n                            hour: \"2-digit\",\n                            minute: \"2-digit\",\n                          })}\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-4 mb-6\">\n                      {order.items.map((item, index) => (\n                        <div key={index} className=\"flex gap-4 items-center\">\n                          {/* Image removed */}\n                          <div className=\"flex-1\">\n                            <h4 className=\"font-medium text-navy line-clamp-2\">\n                              {item.productName}\n                            </h4>\n                            <div className=\"text-sm text-gray-500\">\n                              {item.quantity} шт x {item.price} грн\n                            </div>\n                          </div>\n                          <div className=\"font-bold text-navy\">\n                            {item.totalPrice} грн\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n\n                    <div className=\"flex justify-between items-center pt-4 border-t border-gray-100\">\n                      <div className=\"text-gray-500 text-sm\">\n                        {/* Address removed */}\n                      </div>\n                      <div className=\"text-xl font-bold text-teal\">\n                        {order.totalAmount} грн\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default UserPage;\n"],"names":[],"mappings":"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","debugId":null}}]
}